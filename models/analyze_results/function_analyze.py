from pydantic import BaseModel, Field
from typing import Literal

class FunctionClassifyResponse(BaseModel):
    """Response of function classify and analysis, including replacement info"""
    function_name: str = Field(description="Name of the function to be classified")
    function_type: Literal["RECV", "IRQ", "RETURNOK", "SKIP", "NEEDCHECK", "NODRIVER", "INIT"] = Field(default="NEEDCHECK", description="Classification of driver functions based on their functionality and characteristics")
    functionality: str = Field(default="", description="Description of the main functionality of the function")
    classification_reason: str = Field(default="", description="Explanation of the classification result")
    has_replacement: bool = Field(default=False, description="Whether the function has a replacement")
    function_replacement: str = Field(default="", description="Function content generated by llm after analyzing the function (if any)")

class ReplacementUpdate(BaseModel):
    """Update of function replacement"""
    function_name: str = Field(description="Name of the function to be updated")
    replacement_code: str = Field(description="Function content generated by llm after analyzing the function (if any)")
    reason: str = Field(description="Reason for the replacement")

class FixedFunctionInfo(BaseModel):
    """Information of fixed function"""
    function_name: str = Field(description="Name of the fixed function")
    fixed_code: str = Field(description="Modified function source code to fix the issues")
    reason: str = Field(description="Reason for the modifications made to the function")

class FunctionFixerResponse(BaseModel):
    """Summary of function fix results, including details of modified functions and reason"""
    fixed_functions: dict[str, FixedFunctionInfo] = Field(description="Mapping of function names to their fixed code and reason")
    reason: str = Field(description="Explanation of the modifications made to the functions, Summary of the analysis and changes")

